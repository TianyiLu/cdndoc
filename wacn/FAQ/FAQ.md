# 常见问题

##服务咨询

- **CDN标准和CDN高级有什么区别？**
     
    主要区别就是价格不同。目前CDN高级版仅包含https的加速服务，后续会逐步增加其他的高级加速服务。

- **目前高级版CDN服务包括哪些加速类型？**

    目前上线的高级版 CDN 服务只包括 HTTPS 协议加速。目前如果您想使用 CDN HTTPS 加速服务，请通过支持页面联系 Windows Azure 的支持团队开通 CDN HTTPS 加速服务。
- **动态加速和静态加速的配置是否一致**
  
    现阶段提供的CDN主要是静态加速，包含一部分动态加速技术。比如：通过多线路节点回源，TCP优化等。不支持对PHP，ASP.NET，JSP等动态网页的加速，后续会逐步增加更多对动态页面的加速。
- **HTTP和HTTPS的服务请求是否分开？**
   
    如果客户只需要http加速，请通过Azure管理门户直接完成创建配置。如果客户需要HTTPS加速，请联系Azure Support开通。注意，开通HTTPS加速的同时可以指定是否同时开通http，但通过这种方式开通的http访问所产生的流量，按https的价格统一计费。
- **Windows Azure CDN支持Storage 上的哪些视频文件类型？**

	目前支持MP4,FLV,AVI等常见视频封装格式的视频文件的HTTP VOD加速。同时支持Windows Azure媒体服务。

- **静态视频文件与普通静态页面文件的加速模式有差别吗？**
	
    没有不同，都是HTTP下载方式的加速模式，目前使用的是相同的一组CDN节点进行加速的。
	
- **如果是为视频网站加速，其视频文件放在VM附加磁盘上。应该如何选择CDN类型为网站加速？**

    这要看客户想要加速的内容。
    1. 如果主要是视频加速的话，客户可以选择CDN 的VOD 加速类型。
    2. 如果主要是静态网页加速的话，选择web加速即可。
    3. 如果两者都需要的话，客户需要在设计时候考虑把这两者分开，分别做CDN加速。

- **选择云服务，意味着云内的资源都被加速了？ 还是Azure能够自动识别出其中的所有视频文件？**

    意味着云内的资源都被加速了，Azure加速不会扫面磁盘，进而只针对视频文件加速。而是会对云服务下所有资源加速，也就是说各个CDN节点缓存内容超过磁盘内视频文件文件大小，是云服务下整体数据缓存。
    总结一下：所有可加速的文件都会做加速，之所以有加速类型选择，是后台的cdn节点可据此做优化。
	
- **CDN加速类型中的“WEB加速”、“下载加速”、“VOD加速”具体有什么区别？**

    不同的CDN加速类型对应于不同的客户使用场景：
    1.WEB加速对应于网页等（html，CSS,图片，JS）比较小的静态文件加速
    2.下载加速一般对应于20MB以上的大文件文件分发
    3.VOD加速对应于基于HTTP的视频点播加速
    对应到后端CDN的不同之处主要在于，不同的加速类型由不同的CDN节点设备来支撑。从客户的角度来说，这些都是透明的，不需要客户做更多的额外配置。

- **在Azure上使用媒体服务做视频直播，在线直播是否支持CDN加速？**
    
- **Azure CDN合作的CDN服务厂商都有谁？

    目前Windows Azure CDN和蓝汛和网宿合作，为用户提供优质的CDN加速服务。

- **CDN是否支持流媒体、动态网站等动态内容，是否有成功案例，想了解如何实现？**
    
    目前支持基于HTTP的流媒体（VOD 和 HLS直播），目前还没有整理具体的成功案例。动态网站加速目前不支持，但在计划中。

- **Windows Azure CDN缓存规则逻辑是什么？
	缓存规则逻辑：
	1、 如果用户配置了不缓存的规则，优先匹配；然后匹配需要缓存的规则；
	2、 如果某个URL在不缓存、缓存规则里都没有匹配上，那么就走CDN默认规则（遵循源站响应Header设置，如果有cookie、no-cache、expires等限制，就不缓存，否则就会缓存）
	3、 管理系统 “缓存规则配置”界面，新增加了“不缓存未指定类型”功能。即：凡是客户未配置需要缓存的内容，都不缓存。	 
	另域名：www.auchanwines.com
	规则：默认全都不缓存，仅缓存后缀.txt|.bmp|.gif|.jpg|.png|.xml|.yaml|.jpeg|.text|.webp的文件
	
	 
- **各CDN节点从源站读取数据时的过程是怎样的？是各CDN节点直接从源站读取数据吗？还是只有一个CDN总节点从原站读取数据，然后其它CDN节点从该总节点再读取数据的？**
	
    cdn节点直接回原
		
- **CDN多个源IP配置时，cdn回源的方式是什么，比如：随机选择IP地址回源、主备线路回源、最近线路回源、最优线路回源？**
	
    CDN多个源IP配置时，cdn会根据当时的链路情况，择优回源
	
- **如果域名在运营商处申请了智能解析双线路的话，那么配置CDN时，是填写多个IP比较好，还是填写域名比较好？
	
    如果域名在运营商处申请了智能解析双线路的话，填写多个IP比较好

- **“源站地址（回源地址）”和“回源域名（回源host header）”的区别是什么？
	 
	回源地址表示源站实际可以被访问到的地址，可以是IP也可以是域名。如果是域名，CDN在回源是会对该域名进行地址解析，然后用解析出来的IP再进行访问。
	回源域名表示CDN回源时，HTTP请求头（request header）中的Host字段值。这个字段值一般是域名形式的字符串，被源站用来识别是否与源站服务器上配置的域名相同。
	 
	在azure management portal里创建CDN的时候，在“原点主机标头（origin host header）”中输入您的源站所接受的回源访问host header。当您输入完“自定义域”之后，系统会根据您所选择的“原始域类型”来自动填充一个默认值。具体的规则是，如果您的源站是在Azure上的话，默认值就是相应的源站地址。如果您的源站不在Azure上，默认值是您输入的“自定义域名”，当然您也可以根据自己源站的实际配置情况来修改。
- **哪些因素会影响 CDN 本地缓存中内容的可用性，如何降低对频繁发出原始请求的需求？**

     CDN 本地缓存中内容的可用性（通常称为“缓存功效”或“卸载”）会受到许多因素的影响，其中包括：

     - 有效期（“最大有效期”）标头值
     - 开发人员的内容库的总大小（可以缓存的数量）
     - 活动的工作集（当前缓存的数量）
     - 流量（提供的数量）
     - 缓存改动（将对象添加到缓存的频率，或老化的频率）

     例如，如果开发人员用对内容的改动频率更频繁，流量更大，则此开发人员的缓存效率将低于其他用户，因为换入和换出对象的频率会更高。这会导致更高的存储和数据传输费用，因为需要的原始请求更多。

     为了降低发出原始请求的需求，您可以设置更长的最大有效期标头，从而允许 CDN 将对象保留更长时间。

- **为什么使用CDN一定要有备案号？**
 
     使用CDN以后解析出来的IP是FC节点IP。如果没有备案工信部发现的话会直接封IP的。为了后续不给您带来更多的麻烦建议没有备案或者备案号被取消的域名申请备案待工信部能查到后再使用加速服务。

- **如果域名有跳转是否可以使用CDN？**
     
     可以，不过建议给跳转后的域名加速，跳转前的域名加速没有必要。

- **使用CDN条件**
    1. 域名必须有备案且备案号和工信部查询一致
    2. 非游戏类，出售成人用品、药物和管制刀具类，及含有不法言论信息的网站
    3. 加速域名必须能正常解析
    4. 源服务器80端口或者443端口开放，CDN支持http和https协议

- **一个账户内是否对本账户添加的加速域名个数有限制？**

     Windows Azure CDN对每个账户的加速域名个数没有做限制。

- **如何查看加速效果**

     系统自带统计功能，可以查看CDN的加速效果，开始使用服务后，您可以在自己的账户中看到相关的统计信息，以图表的方式展示对比信息，非常直观。
     您也可以通过第三方统计工具对加速效果做监测，比如基调、博瑞等，对CDN的服务效果做一个第三方的监测，不过这种第三方监测工具是收费的，详情可以联系相应的服务提供商。

- **节点数量是否越多越好吗**
    
     不完全是。加速的好坏除了节点多少外，最重要是还节点的科学分布和配置，单纯的节点越多越好是不准确的，假如节点过多的话缓存的命中率下降，反而会降低速度。

- **回原的时候是否会造成大量的节点一起回原？** 

     具体看原站实际情况，如果原站访问量比较大并且各节点都没有缓存资源，当有大量的请求原站时必然节点会回原，但是不一定是所有节点都回原。如果节点一旦缓存在缓存尚未过期内网民解析到该节点不再需要回原直接读取节点资源。

-  **怎么刷新缓存？** 
  
      1. 自动刷新：缓存规则配置中设置缓存时间
      2. 手动刷新：根据实际更新URL提交目录或者问价刷新，文件刷新更快些。
      
- **CDN与双线机房的区别？**

     双线机房的概念是优化了两个运营商用户的访问，比如联通电信双线机房，能对联通用户和电信用户的访问有一定的优化。
     使用CDN服务后，可以对用户的访问有一个整体的提升，比如覆盖了更多的运营商、优化了跨区域的访问质量，用户访问路由优化等，访问更稳定，服务质量更高，通过CDN边缘节点提供服务避免用户对源站的直接访问提升了安全性等。

- **CDN服务是否支持RTMP直播加速？**

##价格咨询
- **在每月传输的数据超过 10TB 后，是否按更高等级的费率对所有数据传输计费？**

    不。属于每个等级的使用量将按照针对该等级的费率计费。例如，如果您在区域 1 产生了 50TB 的标准版 CDN 数据传输，前 10TB 将按照每 GB ¥ 0.45 的费率计费，剩下的 40TB 将按照每 GB ¥ 0.41 的费率计费。

- **CDN 收费中是否包含对存储进行请求，以便检索数据并将数据从存储传输到 CDN 位置的费用？**
   
     不包含。当 CDN 收到针对非位于边缘位置的对象请求时，将向 Azure 存储发出请求以获取数据。从存储读取数据以及将数据从存储传输到 CDN 的操作将按照标准的[数据传输](http://www.windowsazure.cn/pricing/details/data-transfer/)费率收费。

##技术咨询
- **CDN的概念、作用**

    CDN 的全称是 Content Delivery Network,即内容分发网络。其目的是通过在现有的 Internet 中添加一层新的网络架构，将网站的内容发布到最接近用户网络“边缘”，使用户可以就近取得所需的内容，解决 Internet 网络拥挤的状况，提高用户访问网站的响应速度。从技术上全面解决由于网络带宽小、用户访问量大、网点分布不均等原因所造成的用户访问网站响应速度慢的问题。（也就是将一个服务器的内容，平均分布到多个服务器上，服务器智能识别，让用户获取离用户最近的服务器，提供访问速度）。

- **CDN流量和回原流量关系**
    - CDN流量表示缓存命中部分
    - 回原流量表示MISS部分
    
- **为什么回原大于CDN流量？**
 
    一般回原流量<=CDN流量，特殊情况也可能出现回原流量大于CDN流量，比如：如果访问者发起一个请求，请求一个比较大的文件。比如100M，如果节点没有缓存的情况， CDN节点就会去源站获取，这么大文件必然需要点时间，然而此时，访问者又不继续等了于是就断开连接。。。这样，CDN节点还是会去把100M文件全都拿过来。此时发现访问者已经不要它了，它就没法再返回了，于是，回源的流量就有100M，而CDN流量没有。

- **更换原站服务器是否需要操作，如何操作？**
    
    需要。首先要确保域名能正常解析，然后在管理平台—域名管理中将原站地址变更为新的地址，保存即可。

- **可否提供日志分析，目前提供的是什么样的日志，如何查看？

    暂时不提供不提供日志分析，会在后续更新中加入该功能。

- **CNAME解析已经生效，为什么还是解析到源站IP呢？**
 
    1. 如果是新添加的域名刚刚执行的cname操作建议稍等5~10分钟测试，可以在Webluker官网站长工具中的域名探测全国域名解析情况（http://www.webluker.com/webtools/dns）
    2. 有可能是之前添加的域名，因为某种原因（比如流量超标，备案号被取消，疑似攻击等）系统关闭服务，此时就会出现域名已经cname过来但是最终还是指向原站ip
    3. 有可能设置局部回原。比如设置电信局部回原，恰好您的出口ip就是电信运营商，这样即便是cname到Webluker电信网民访问都是直接回原的。


##服务配置

- **如何配置CNAME？**

     到域名托管商找到该域名解析管理—删除该域名的A记录—添加一条cname记录，cname的域名我们已经给出。

- **怎么确认我的CNAME记录生效了？**

     各地DNS的生效时间不一致，取决于域名对应的原有记录的生效时间（TTL时间）。当ping（或者dig）域名，给出的解析不再是您源站IP，说明已经生效了。
- **为什么我的URL不能缓存？**

     URL不能被缓存，通常有以下几个原因： 
     1. 源站的该URL响应Header里含有以下信息：
        - Set-Cookie（且缓存规则里并未勾选忽略Set-Cookie选项）。注：Set-Cookie在用于用户登录和身份识别时是不能勾选忽略Set-Cookie选项的，否则可能引起功能性问题。
        - Cache-Control：no-store/no-cache/private（且缓存规则里并未勾选忽略Cache-Control选项）。
        - Expires的时间是过去的某个时间，Expires指定了缓存到期时间点，如果是过去时间，则将导致无法缓存。
        - Max-age的值很小，Max-age指定了缓存时间长度，单位为秒，如果太小，如小于两位数，那么很快就会过期，导致无法缓存。
      2. 缓存规则里没有配置或配置错误，URL无法命中任何一个缓冲规则，例如，有用户不小心录入以下规则:” [任意字符](.gif|.jpg|.bmp) (.gif|.jpg|.bmp)”，那么即使是图片类型也无法命中规则，因为扩展名重复。
      3. 部分节点暂时还没有用户访问该URL，需要有访问之后才会缓存

- **为什么域名会解析到源站？**

     如果一个域名CDN的加速区域为中国大陆，海外网民或者中国网民使用非中国DNS解析就会解到源站。

##使用障碍
- **系统提示不能CNAME**

     有可能，虽然我们没有限制加速域名但是有的域名托管商不允许不带有主机名的域名进行cname，对此，没有更好的办法：要么更换加速域名，要么更换域名托管商。
- **用了CDN后打开速度更慢**

    1. 缓存命中率不高，影响缓存命中率的几个原因：
       - 缓存配置的问题
       - Http Header导致无法缓存
       - 刚添加，缓存的文件还不多
       - 源站类型，可缓存的内容少
       - 网站访问量低，过期时间短，命中的文件少
    2. 局部问题，个别区域回原较慢。

- **回源比例比较大** 

    1. 缓存规则配置问题
    2. 可缓存资源少
    3. 缓存时间短
    
 - **使用CDN后，网站打不开 ** 

     可能因素：
     1. 原站故障
     2. 原站有设置防火墙，屏蔽FC
     3. 节点屏蔽客户ip 
     4. 新添加域名/域名状态变更，节点配置下发问题
     5. 设备故障
     
 - **使用CDN后，网站登录异常**
 
     很有可能是在缓存规则中设置了不该缓存的资源，需要将用户后台登陆的文件夹设置不缓存（如： /user  或者 /admin等等）；同时在缓存规则配置中一定不要勾选set-cookie

- **源站宕机，CDN未生效**
    
    如果有客户访问资源有设置缓存且在原站故障前各节点都缓存了该部分资源同时缓存尚未过期，缓存资源仍可以访问；否则该url仍然不能访问。

- **缓存刷新失败**

    手动提交刷新后系统会统计正常服务的设备来下发任务，如果任务下发过程中某一台设备出现异常，系统会自动检测出来并探测关闭（服务状态关闭后客户不会解析到该节点，不影响加速服务），其他正常设备继续下发任务，直至完成，此时界面就会显示“刷新失败”，同时客服和运维会接到邮件，第一时间做处理，即便是刷新失败不影响CDN服务。

- **为什么没有cname到Windows Azure CDN却消耗CDN流量**

    有可能，因为只要加速域名的服务状态是开启的，即便没有到cname我们的探测设备都会通过监控url探测原站和加速情况，这个也是为什么我们建议您选择监控url尽可能选择小一些的文件，如果您不想未cname消耗流量可以将服务状态关闭。




